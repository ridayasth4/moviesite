{% extends 'movies/base.html' %}

{% block title %}Home | CinemaFlix{% endblock %}

{% block extra_css %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<style>
  .hover-opacity-100 { transition: opacity 0.3s; }
  .hover-opacity-100:hover { opacity: 1 !important; }
  .carousel-caption { background: rgba(0,0,0,0.5);}
</style>
{% endblock %}

{% block hero %}
<!-- HERO CAROUSEL -->
<div id="featuredCarousel" class="carousel slide mb-4 p-4" data-bs-ride="carousel">
  <div class="carousel-inner rounded-4">
    {% for movie in movies %}
    <div class="carousel-item {% if forloop.first %}active{% endif %} position-relative">
      {% if movie.is_new %}
      <div class="position-absolute top-0 start-0 m-2"><span class="badge bg-danger rounded-pill">NEW</span></div>
      {% endif %}
      {% if movie.poster %}
      <img src="{{ movie.poster.url }}" class="d-block w-100" alt="{{ movie.title }}" style="height: 400px; object-fit:cover;">
      {% else %}
      <div class="d-flex align-items-start justify-content-center bg-dark text-light" style="height:400px;">
        <h2>{{ movie.title }}</h2>
      </div>
      {% endif %}

      <div class="carousel-caption text-start p-4 rounded-4">
        <h3 class="fw-bold">{{ movie.title }}</h3>
        <p>{{ movie.description|truncatechars:50 }}</p>
        <p class="mb-1 small">{{ movie.genre.name }}</p>
        <span class="small"><i class="bi bi-clock me-1"></i><small>{{ movie.display_duration }}</small></span>

        <!-- Stars -->
        <div class="position-relative top-0 mb-2">
          <span class="badge text-warning">
            {% for star in movie.stars_list %}
              {% if star == 'full' %}<i class="bi bi-star-fill"></i>{% elif star == 'half' %}<i class="bi bi-star-half"></i>{% else %}<i class="bi bi-star"></i>{% endif %}
            {% endfor %}
            {{ movie.avg_rating|default:"N/A"|floatformat:1 }}
          </span>
        </div>

        <a href="{% url 'movie_detail' movie.pk %}" class="btn btn-danger btn-sm">
          <i class="bi bi-play-fill me-1"></i> Watch Now
        </a>        
      </div>
    </div>
    {% endfor %}
  </div>

  <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</div>
{% endblock %}

{% block content %}

<!-- Latest Release -->
<section>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="text-light fw-bold">Latest Release</h3>
    <a href="{% url 'latest_movies' %}" class="btn btn-dark btn-sm"><i class="bi bi-grid me-1"></i>View All</a>
  </div>

  {% if latest_movies %}
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-4 p-3">
    {% for movie in latest_movies %}
      {% include 'movies/movie_card.html' with movie=movie delay=forloop.counter0 user_fav_ids=user_fav_ids %}
    {% endfor %}
    </div>


{% else %}
<p class="text-light">No movies found.</p>
{% endif %}
</section>

<!-- Top Rated -->
<section>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="text-light fw-bold">Top Rated</h3>
    <a href="{% url 'top_rated_movies' %}" class="btn btn-dark btn-sm"><i class="bi bi-grid me-1"></i>View All</a>
  </div>

  {% if trending_movies %}
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-4 p-3">
    {% for movie in trending_movies %}
      {% include 'movies/movie_card.html' with movie=movie delay=forloop.counter0 user_fav_ids=user_fav_ids %}
    {% endfor %}
  </div>
  {% else %}
  <p class="text-secondary">No trending movies at the moment.</p>
  {% endif %}
</section>


<!-- Latest Upload / All movies -->
<section>
  <div class="d-flex justify-content-between align-items-center">
    <h3 class="text-light fw-bold">Explore movies</h3>
    <a href="{% url 'movie_list' %}" class="btn btn-dark btn-sm"><i class="bi bi-grid me-1"></i>View All</a>
  </div>

  {% if other_movies %}
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-4 p-3">
    {% for movie in other_movies %}
      {% include 'movies/movie_card.html' with movie=movie delay=forloop.counter0 user_fav_ids=user_fav_ids %}
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-5 bg-black rounded border border-secondary">
    <i class="bi bi-film display-1 text-secondary mb-3"></i>
    <h4 class="text-secondary mb-2">No movies available</h4>
    <p class="text-muted mb-3">Start adding movies to your collection</p>
    <a href="{% url 'movie_list' %}" class="btn btn-danger"><i class="bi bi-plus-circle me-1"></i>Add Movies</a>
  </div>
  {% endif %}
</section>

<!-- Movies by Genre -->
{% for genre, movies in movies_by_genre.items %}
<section class="mb-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="text-light fw-bold">{{ genre.name }}</h3>
    <a href="{% url 'movie_list_by_genre' genre.id %}" class="btn btn-dark btn-sm"><i class="bi bi-grid me-1"></i>View All</a>
  </div>

  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-4">
    {% for movie in movies %}
      {% include 'movies/movie_card.html' with movie=movie delay=forloop.counter0 user_fav_ids=user_fav_ids %}
    {% endfor %}
  </div>
</section>
{% endfor %}

{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>AOS.init({ once: true });</script>
{% endblock %}
