{% extends 'movies/base.html' %}
{% block title %}
{% if selected_genre %}{{ selected_genre.name }} Movies | CinemaFlix{% else %}All Movies | CinemaFlix{% endif %}
{% endblock %}

{% block content %}

<!-- Page title -->
<h2 class="text-light mb-4 mt-4">
{% if search_query %}
  Search results for "{{ search_query }}"
{% elif selected_genre %}
  Movies in {{ selected_genre.name }}
{% elif filter_type == 'top-rated' %}
  Top Rated Movies
{% elif filter_type == 'latest' %}
  Latest Releases
{% elif filter_type == 'trending' %}
  Trending Movies
{% else %}
  All Movies
{% endif %}
</h2>

<!-- -------------------
     All Movies Section (Paginated)
------------------- -->
{% if page_obj %}
<div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 g-4">
  {% for movie in page_obj %}
    {% include 'movies/movie_card.html' with movie=movie delay=forloop.counter0 user_fav_ids=user_fav_ids %}
  {% endfor %}
</div>


{% else %}
<p class="text-light">No movies found.</p>
<a href="{% url 'movie_list' %}" class="text-light mt-2">
  Click here to see all movies
</a>

{% endif %}

<!-- -------------------
     Movies by Genre Sections
     Only show if NOT viewing a single genre
------------------- -->
{% if not selected_genre and not search_query %}
  {% for genre, movies in movies_by_genre.items %}
    <section class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-light fw-bold">{{ genre.name }}</h3>
        <a href="{% url 'movie_list_by_genre' genre.id %}" class="btn btn-dark btn-sm">
          <i class="bi bi-grid me-1"></i>View All
        </a>
      </div>

      <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-4">
        {% for movie in movies %}
          {% include 'movies/movie_card.html' with movie=movie delay=forloop.counter0 user_fav_ids=user_fav_ids %}
        {% endfor %}
      </div>
    </section>
  {% endfor %}
{% endif %}

{% endblock %}
